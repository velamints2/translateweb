# ğŸ§ª è¶…çº§å…¨é¢æµ‹è¯•è®¡åˆ’

## æµ‹è¯•ç›®æ ‡
å…¨é¢æµ‹è¯•ç¿»è¯‘ç³»ç»Ÿçš„é²æ£’æ€§ã€å¯é æ€§ã€æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œç¡®ä¿åœ¨å„ç§æç«¯æƒ…å†µä¸‹éƒ½èƒ½ç¨³å®šè¿è¡Œã€‚

---

## ğŸ“‹ æµ‹è¯•åˆ†ç±»

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
### 2. é›†æˆæµ‹è¯• (Integration Tests)
### 3. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
### 4. å‹åŠ›æµ‹è¯• (Stress Tests)
### 5. è¾¹ç•Œæµ‹è¯• (Boundary Tests)
### 6. é”™è¯¯å¤„ç†æµ‹è¯• (Error Handling Tests)
### 7. æ€§èƒ½æµ‹è¯• (Performance Tests)
### 8. å®‰å…¨æµ‹è¯• (Security Tests)
### 9. å…¼å®¹æ€§æµ‹è¯• (Compatibility Tests)
### 10. ç”¨æˆ·ä½“éªŒæµ‹è¯• (UX Tests)

---

## 1ï¸âƒ£ å•å…ƒæµ‹è¯•

### 1.1 é£ä¹¦çŸ¥è¯†åº“å·¥å…·æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/unit/feishu-knowledge-base.test.js`

```javascript
describe('é£ä¹¦çŸ¥è¯†åº“å·¥å…·', () => {
  // æ­£å¸¸æµç¨‹
  test('åŠ è½½æœ¯è¯­åº“', async () => {
    const terms = await feishuTool.load()
    expect(terms).toBeArray()
    expect(terms.length).toBeGreaterThan(0)
  })

  test('æŸ¥è¯¢å­˜åœ¨çš„æœ¯è¯­', async () => {
    const result = await feishuTool.query('æ¿€å…‰é›·è¾¾')
    expect(result).toEqual({ original: 'æ¿€å…‰é›·è¾¾', translation: 'LiDAR' })
  })

  test('æŸ¥è¯¢ä¸å­˜åœ¨çš„æœ¯è¯­', async () => {
    const result = await feishuTool.query('ä¸å­˜åœ¨çš„æœ¯è¯­')
    expect(result).toBeNull()
  })

  // è¾¹ç•Œæƒ…å†µ
  test('ç©ºå­—ç¬¦ä¸²æŸ¥è¯¢', async () => {
    const result = await feishuTool.query('')
    expect(result).toBeNull()
  })

  test('è¶…é•¿å­—ç¬¦ä¸²æŸ¥è¯¢', async () => {
    const longTerm = 'a'.repeat(10000)
    const result = await feishuTool.query(longTerm)
    expect(result).toBeNull()
  })

  test('ç‰¹æ®Šå­—ç¬¦æŸ¥è¯¢', async () => {
    const result = await feishuTool.query('@#$%^&*()')
    expect(result).toBeNull()
  })

  // ç¼“å­˜æµ‹è¯•
  test('ç¼“å­˜æœ‰æ•ˆæœŸ', async () => {
    await feishuTool.load()
    // ç¬¬äºŒæ¬¡åº”è¯¥ä»ç¼“å­˜è¯»å–
    const start = Date.now()
    await feishuTool.load()
    const duration = Date.now() - start
    expect(duration).toBeLessThan(10) // ç¼“å­˜åº”è¯¥å¾ˆå¿«
  })

  // é”™è¯¯å¤„ç†
  test('APIå¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', async () => {
    // æ¨¡æ‹ŸAPIå¤±è´¥
    mockAPIFailure()
    const terms = await feishuTool.load()
    expect(terms).toBeArray() // åº”è¯¥è¿”å›æ¨¡æ‹Ÿæ•°æ®
    expect(terms.length).toBeGreaterThan(0)
  })
})
```

### 1.2 é¢„å¤„ç†å·¥å…·æµ‹è¯•

```javascript
describe('é¢„å¤„ç†æ–‡æœ¬å·¥å…·', () => {
  // æ­£å¸¸æµç¨‹
  test('åˆ†ææ™®é€šæ–‡æœ¬', async () => {
    const result = await preprocessTool.analyze('æµ‹è¯•æ–‡æœ¬', 'ZH', 'EN', [])
    expect(result).toHaveProperty('documentInfo')
    expect(result).toHaveProperty('properNouns')
  })

  // è¾¹ç•Œæƒ…å†µ
  test('ç©ºæ–‡æœ¬åˆ†æ', async () => {
    await expect(
      preprocessTool.analyze('', 'ZH', 'EN', [])
    ).rejects.toThrow()
  })

  test('è¶…é•¿æ–‡æœ¬åˆ†æ', async () => {
    const longText = 'a'.repeat(100000)
    const result = await preprocessTool.analyze(longText, 'ZH', 'EN', [])
    expect(result).toBeDefined()
  })

  test('çº¯æ•°å­—æ–‡æœ¬', async () => {
    const result = await preprocessTool.analyze('123456789', 'ZH', 'EN', [])
    expect(result.properNouns.length).toBe(0)
  })

  test('çº¯ç¬¦å·æ–‡æœ¬', async () => {
    const result = await preprocessTool.analyze('!@#$%^&*()', 'ZH', 'EN', [])
    expect(result.properNouns.length).toBe(0)
  })

  test('æ··åˆè¯­è¨€æ–‡æœ¬', async () => {
    const text = 'è¿™æ˜¯ä¸­æ–‡ This is English è¿™æ˜¯æ··åˆ'
    const result = await preprocessTool.analyze(text, 'ZH', 'EN', [])
    expect(result).toBeDefined()
  })

  // æ— APIå¯†é’¥æµ‹è¯•
  test('æ— APIå¯†é’¥æ—¶ä½¿ç”¨ç®€åŒ–æ¨¡å¼', async () => {
    process.env.ANTHROPIC_API_KEY = ''
    const result = await preprocessTool.analyze('æµ‹è¯•', 'ZH', 'EN', [])
    expect(result.documentInfo.domain).toBe('æŠ€æœ¯æ–‡æ¡£')
  })
})
```

### 1.3 ç¿»è¯‘Agentæµ‹è¯•

```javascript
describe('ç¿»è¯‘Agentå·¥å…·', () => {
  // æ­£å¸¸æµç¨‹
  test('ç¿»è¯‘çŸ­æ–‡æœ¬', async () => {
    const result = await translateTool.execute(
      'æµ‹è¯•æ–‡æœ¬',
      'ZH',
      'EN',
      [],
      null,
      ''
    )
    expect(result).toHaveProperty('translatedText')
  })

  // è¾¹ç•Œæƒ…å†µ
  test('ç¿»è¯‘ç©ºæ–‡æœ¬', async () => {
    await expect(
      translateTool.execute('', 'ZH', 'EN', [], null, '')
    ).rejects.toThrow()
  })

  test('ç¿»è¯‘è¶…é•¿æ–‡æœ¬ï¼ˆè‡ªåŠ¨åˆ†æ®µï¼‰', async () => {
    const longText = 'æµ‹è¯•æ–‡æœ¬ã€‚'.repeat(1000)
    const result = await translateTool.execute(
      longText,
      'ZH',
      'EN',
      [],
      null,
      ''
    )
    expect(result.translatedText).toBeDefined()
  })

  test('åº”ç”¨æœ¯è¯­ç¿»è¯‘', async () => {
    const terms = [
      { original: 'æ¿€å…‰é›·è¾¾', translation: 'LiDAR', confirmed: true }
    ]
    const result = await translateTool.execute(
      'æ¿€å…‰é›·è¾¾æ˜¯ä¸€ç§ä¼ æ„Ÿå™¨',
      'ZH',
      'EN',
      terms,
      null,
      ''
    )
    expect(result.translatedText).toContain('LiDAR')
  })

  // é”™è¯¯å¤„ç†
  test('æ— APIå¯†é’¥æ—¶æŠ›å‡ºé”™è¯¯', async () => {
    process.env.ANTHROPIC_API_KEY = ''
    await expect(
      translateTool.execute('æµ‹è¯•', 'ZH', 'EN', [], null, '')
    ).rejects.toThrow('Claude APIå¯†é’¥æœªé…ç½®')
  })
})
```

---

## 2ï¸âƒ£ é›†æˆæµ‹è¯•

### 2.1 å®Œæ•´ç¿»è¯‘æµç¨‹æµ‹è¯•

```javascript
describe('å®Œæ•´ç¿»è¯‘æµç¨‹', () => {
  test('ä»æäº¤åˆ°ç¿»è¯‘çš„å®Œæ•´æµç¨‹', async () => {
    // 1. æäº¤æ–‡æœ¬
    const submitResult = await agent.preprocessText('æµ‹è¯•æ–‡æœ¬', 'ZH', 'EN')
    expect(submitResult.properNouns).toBeDefined()

    // 2. ç¡®è®¤æœ¯è¯­
    const confirmedTerms = submitResult.properNouns.map(t => ({
      ...t,
      confirmed: true
    }))

    // 3. æ·»åŠ æœ¯è¯­
    if (confirmedTerms.length > 0) {
      await agent.addTerms(confirmedTerms.filter(t => !t.fromDatabase))
    }

    // 4. æ‰§è¡Œç¿»è¯‘
    const translateResult = await agent.translate(
      'æµ‹è¯•æ–‡æœ¬',
      'ZH',
      'EN',
      confirmedTerms,
      submitResult.documentInfo,
      submitResult.translationStrategy
    )

    expect(translateResult.translatedText).toBeDefined()
  })

  test('çŸ¥è¯†åº“é›†æˆ', async () => {
    // åŠ è½½çŸ¥è¯†åº“
    const terms = await agent.loadKnowledgeBase()
    expect(terms.length).toBeGreaterThan(0)

    // æŸ¥è¯¢æœ¯è¯­
    const term = await agent.queryTerm('æ¿€å…‰é›·è¾¾')
    expect(term).toBeDefined()

    // æ·»åŠ æ–°æœ¯è¯­
    await agent.addTerms([
      { original: 'æ–°æœ¯è¯­', translation: 'New Term' }
    ])

    // éªŒè¯æ·»åŠ æˆåŠŸ
    const newTerm = await agent.queryTerm('æ–°æœ¯è¯­')
    expect(newTerm.translation).toBe('New Term')
  })
})
```

### 2.2 APIè·¯ç”±é›†æˆæµ‹è¯•

```javascript
describe('APIè·¯ç”±é›†æˆ', () => {
  let sessionId

  test('POST /api/submit-text', async () => {
    const response = await request(app)
      .post('/api/submit-text')
      .send({
        text: 'æµ‹è¯•æ–‡æœ¬',
        language_from: 'ZH',
        language_to: 'EN'
      })

    expect(response.status).toBe(200)
    expect(response.body).toHaveProperty('sessionId')
    sessionId = response.body.sessionId
  })

  test('POST /api/confirm-nouns', async () => {
    const response = await request(app)
      .post('/api/confirm-nouns')
      .send({
        sessionId,
        confirmedNouns: [
          { original: 'æµ‹è¯•', translation: 'Test', confirmed: true }
        ]
      })

    expect(response.status).toBe(200)
  })

  test('POST /api/start-translation', async () => {
    const response = await request(app)
      .post('/api/start-translation')
      .send({
        sessionId,
        userInput: 'å¼€å§‹ç¿»è¯‘'
      })

    expect(response.status).toBe(200)
    expect(response.body).toHaveProperty('translatedText')
  })

  test('GET /api/session/:sessionId', async () => {
    const response = await request(app)
      .get(`/api/session/${sessionId}`)

    expect(response.status).toBe(200)
    expect(response.body.id).toBe(sessionId)
  })
})
```

---

## 3ï¸âƒ£ ç«¯åˆ°ç«¯æµ‹è¯• (E2E)

### 3.1 ä½¿ç”¨ Playwright/Cypress

```javascript
describe('å‰ç«¯E2Eæµ‹è¯•', () => {
  test('å®Œæ•´çš„ç”¨æˆ·ç¿»è¯‘æµç¨‹', async () => {
    // 1. è®¿é—®é¦–é¡µ
    await page.goto('http://localhost:5173')

    // 2. è¾“å…¥æ–‡æœ¬
    await page.fill('textarea[placeholder*="è¾“å…¥"]', 'æµ‹è¯•æ–‡æœ¬')

    // 3. é€‰æ‹©è¯­è¨€
    await page.selectOption('select[name="languageFrom"]', 'ZH')
    await page.selectOption('select[name="languageTo"]', 'EN')

    // 4. æäº¤æ–‡æœ¬
    await page.click('button:has-text("æäº¤æ–‡æœ¬")')

    // 5. ç­‰å¾…åˆ†æç»“æœ
    await page.waitForSelector('.analysis-result')

    // 6. ç¡®è®¤æœ¯è¯­
    await page.click('button:has-text("ç¡®è®¤")')

    // 7. å¼€å§‹ç¿»è¯‘
    await page.click('button:has-text("å¼€å§‹ç¿»è¯‘")')

    // 8. éªŒè¯ç»“æœ
    await page.waitForSelector('.translation-result')
    const result = await page.textContent('.translation-result')
    expect(result).toBeTruthy()
  })

  test('æ–‡ä»¶ä¸Šä¼ æµç¨‹', async () => {
    await page.goto('http://localhost:5173')

    // ä¸Šä¼ æ–‡ä»¶
    const fileInput = await page.$('input[type="file"]')
    await fileInput.setInputFiles('test-files/test.txt')

    // ç­‰å¾…æ–‡ä»¶å¤„ç†
    await page.waitForSelector('.file-content')

    // éªŒè¯å†…å®¹
    const content = await page.textContent('.file-content')
    expect(content).toContain('æµ‹è¯•å†…å®¹')
  })
})
```

---

## 4ï¸âƒ£ å‹åŠ›æµ‹è¯•

### 4.1 å¹¶å‘è¯·æ±‚æµ‹è¯•

```javascript
describe('å‹åŠ›æµ‹è¯•', () => {
  test('100ä¸ªå¹¶å‘è¯·æ±‚', async () => {
    const requests = Array(100).fill().map((_, i) =>
      request(app)
        .post('/api/submit-text')
        .send({
          text: `æµ‹è¯•æ–‡æœ¬ ${i}`,
          language_from: 'ZH',
          language_to: 'EN'
        })
    )

    const results = await Promise.all(requests)
    const successCount = results.filter(r => r.status === 200).length
    expect(successCount).toBeGreaterThan(90) // è‡³å°‘90%æˆåŠŸ
  })

  test('é•¿æ—¶é—´è¿è¡Œæµ‹è¯•', async () => {
    const duration = 60000 // 1åˆ†é’Ÿ
    const startTime = Date.now()
    let requestCount = 0
    let errorCount = 0

    while (Date.now() - startTime < duration) {
      try {
        await request(app)
          .post('/api/submit-text')
          .send({ text: 'æµ‹è¯•', language_from: 'ZH', language_to: 'EN' })
        requestCount++
      } catch (error) {
        errorCount++
      }
    }

    console.log(`æ€»è¯·æ±‚: ${requestCount}, é”™è¯¯: ${errorCount}`)
    expect(errorCount / requestCount).toBeLessThan(0.05) // é”™è¯¯ç‡<5%
  })
})
```

### 4.2 å†…å­˜æ³„æ¼æµ‹è¯•

```javascript
test('å†…å­˜æ³„æ¼æ£€æµ‹', async () => {
  const initialMemory = process.memoryUsage().heapUsed

  // æ‰§è¡Œ1000æ¬¡æ“ä½œ
  for (let i = 0; i < 1000; i++) {
    await agent.preprocessText('æµ‹è¯•æ–‡æœ¬', 'ZH', 'EN')
  }

  const finalMemory = process.memoryUsage().heapUsed
  const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024

  console.log(`å†…å­˜å¢é•¿: ${memoryIncrease.toFixed(2)} MB`)
  expect(memoryIncrease).toBeLessThan(100) // å¢é•¿<100MB
})
```

---

## 5ï¸âƒ£ è¾¹ç•Œæµ‹è¯•

### 5.1 è¾“å…¥è¾¹ç•Œ

```javascript
describe('è¾¹ç•Œæµ‹è¯•', () => {
  test('æœ€å°æ–‡æœ¬ï¼ˆ1å­—ç¬¦ï¼‰', async () => {
    const result = await preprocessTool.analyze('æµ‹', 'ZH', 'EN', [])
    expect(result).toBeDefined()
  })

  test('æœ€å¤§æ–‡æœ¬ï¼ˆ100KBï¼‰', async () => {
    const maxText = 'æµ‹è¯•ã€‚'.repeat(20000)
    const result = await preprocessTool.analyze(maxText, 'ZH', 'EN', [])
    expect(result).toBeDefined()
  })

  test('ç©ºæ ¼æ–‡æœ¬', async () => {
    await expect(
      preprocessTool.analyze('   ', 'ZH', 'EN', [])
    ).rejects.toThrow()
  })

  test('æ¢è¡Œç¬¦æ–‡æœ¬', async () => {
    const result = await preprocessTool.analyze('\n\n\n', 'ZH', 'EN', [])
    expect(result).toBeDefined()
  })

  test('æœ€å¤§æœ¯è¯­æ•°é‡', async () => {
    const terms = Array(1000).fill().map((_, i) => ({
      original: `æœ¯è¯­${i}`,
      translation: `Term${i}`
    }))
    const result = await agent.addTerms(terms)
    expect(result.count).toBe(1000)
  })
})
```

### 5.2 å‚æ•°è¾¹ç•Œ

```javascript
describe('å‚æ•°è¾¹ç•Œæµ‹è¯•', () => {
  test('æ— æ•ˆçš„è¯­è¨€ä»£ç ', async () => {
    await expect(
      preprocessTool.analyze('æµ‹è¯•', 'INVALID', 'EN', [])
    ).rejects.toThrow()
  })

  test('Nullå‚æ•°', async () => {
    await expect(
      preprocessTool.analyze(null, 'ZH', 'EN', [])
    ).rejects.toThrow()
  })

  test('Undefinedå‚æ•°', async () => {
    await expect(
      preprocessTool.analyze(undefined, 'ZH', 'EN', [])
    ).rejects.toThrow()
  })

  test('å¯¹è±¡å‚æ•°ï¼ˆåº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼‰', async () => {
    await expect(
      preprocessTool.analyze({text: 'æµ‹è¯•'}, 'ZH', 'EN', [])
    ).rejects.toThrow()
  })
})
```

---

## 6ï¸âƒ£ é”™è¯¯å¤„ç†æµ‹è¯•

### 6.1 ç½‘ç»œé”™è¯¯

```javascript
describe('ç½‘ç»œé”™è¯¯å¤„ç†', () => {
  test('APIè¶…æ—¶', async () => {
    // æ¨¡æ‹Ÿè¶…æ—¶
    mockAPITimeout()
    await expect(
      translateTool.execute('æµ‹è¯•', 'ZH', 'EN', [], null, '')
    ).rejects.toThrow()
  })

  test('APIè¿”å›500', async () => {
    mockAPIError(500)
    const result = await preprocessTool.analyze('æµ‹è¯•', 'ZH', 'EN', [])
    // åº”è¯¥é™çº§åˆ°ç®€åŒ–æ¨¡å¼
    expect(result.documentInfo.domain).toBe('æŠ€æœ¯æ–‡æ¡£')
  })

  test('APIè¿”å›404', async () => {
    mockAPIError(404)
    await expect(
      translateTool.execute('æµ‹è¯•', 'ZH', 'EN', [], null, '')
    ).rejects.toThrow()
  })

  test('ç½‘ç»œæ–­å¼€', async () => {
    mockNetworkDisconnect()
    const result = await agent.loadKnowledgeBase()
    // åº”è¯¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    expect(result.length).toBeGreaterThan(0)
  })
})
```

### 6.2 æ–‡ä»¶å¤„ç†é”™è¯¯

```javascript
describe('æ–‡ä»¶å¤„ç†é”™è¯¯', () => {
  test('æŸåçš„PDF', async () => {
    await expect(
      extractTextFromFile('corrupt.pdf', 'application/pdf', 'test.pdf')
    ).rejects.toThrow()
  })

  test('ç©ºæ–‡ä»¶', async () => {
    await expect(
      extractTextFromFile('empty.txt', 'text/plain', 'empty.txt')
    ).rejects.toThrow()
  })

  test('è¶…å¤§æ–‡ä»¶ï¼ˆ>10MBï¼‰', async () => {
    // æ–‡ä»¶ä¸Šä¼ åº”è¯¥è¢«æ‹’ç»
    const response = await request(app)
      .post('/api/upload-file')
      .attach('file', 'large-file.txt')

    expect(response.status).toBe(413) // Payload Too Large
  })

  test('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹', async () => {
    const response = await request(app)
      .post('/api/upload-file')
      .attach('file', 'test.exe')

    expect(response.status).toBe(400)
    expect(response.body.error).toContain('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹')
  })
})
```

---

## 7ï¸âƒ£ æ€§èƒ½æµ‹è¯•

### 7.1 å“åº”æ—¶é—´

```javascript
describe('æ€§èƒ½æµ‹è¯•', () => {
  test('çŸ¥è¯†åº“åŠ è½½<100ms', async () => {
    const start = Date.now()
    await agent.loadKnowledgeBase()
    const duration = Date.now() - start
    expect(duration).toBeLessThan(100)
  })

  test('æœ¯è¯­æŸ¥è¯¢<10ms', async () => {
    await agent.loadKnowledgeBase() // é¢„çƒ­ç¼“å­˜
    const start = Date.now()
    await agent.queryTerm('æ¿€å…‰é›·è¾¾')
    const duration = Date.now() - start
    expect(duration).toBeLessThan(10)
  })

  test('ç®€åŒ–åˆ†æ<500ms', async () => {
    process.env.ANTHROPIC_API_KEY = ''
    const start = Date.now()
    await agent.preprocessText('æµ‹è¯•æ–‡æœ¬'.repeat(100), 'ZH', 'EN')
    const duration = Date.now() - start
    expect(duration).toBeLessThan(500)
  })
})
```

### 7.2 ååé‡

```javascript
test('æ¯ç§’å¤„ç†è¯·æ±‚æ•°', async () => {
  const duration = 10000 // 10ç§’
  const startTime = Date.now()
  let requestCount = 0

  while (Date.now() - startTime < duration) {
    await agent.queryTerm('æµ‹è¯•')
    requestCount++
  }

  const rps = requestCount / (duration / 1000)
  console.log(`RPS: ${rps.toFixed(2)}`)
  expect(rps).toBeGreaterThan(100) // è‡³å°‘100 RPS
})
```

---

## 8ï¸âƒ£ å®‰å…¨æµ‹è¯•

### 8.1 æ³¨å…¥æ”»å‡»

```javascript
describe('å®‰å…¨æµ‹è¯•', () => {
  test('SQLæ³¨å…¥é˜²æŠ¤', async () => {
    const maliciousInput = "'; DROP TABLE users; --"
    const result = await agent.preprocessText(maliciousInput, 'ZH', 'EN')
    expect(result).toBeDefined() // ä¸åº”è¯¥å´©æºƒ
  })

  test('XSSæ”»å‡»é˜²æŠ¤', async () => {
    const xssInput = '<script>alert("XSS")</script>'
    const response = await request(app)
      .post('/api/submit-text')
      .send({ text: xssInput, language_from: 'ZH', language_to: 'EN' })

    expect(response.status).toBe(200)
    expect(response.body.sessionId).toBeDefined()
  })

  test('å‘½ä»¤æ³¨å…¥é˜²æŠ¤', async () => {
    const cmdInput = '; rm -rf / ;'
    const result = await agent.preprocessText(cmdInput, 'ZH', 'EN')
    expect(result).toBeDefined()
  })
})
```

### 8.2 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

```javascript
test('APIå¯†é’¥ä¸åº”å‡ºç°åœ¨æ—¥å¿—', async () => {
  process.env.ANTHROPIC_API_KEY = 'sk-ant-test-key'
  await agent.preprocessText('æµ‹è¯•', 'ZH', 'EN')

  const logs = fs.readFileSync('logs/combined.log', 'utf8')
  expect(logs).not.toContain('sk-ant-test-key')
})

test('é”™è¯¯å“åº”ä¸æ³„éœ²å†…éƒ¨ä¿¡æ¯', async () => {
  const response = await request(app)
    .post('/api/submit-text')
    .send({ text: '' })

  expect(response.body.stack).toBeUndefined() // ä¸åº”è¯¥è¿”å›å †æ ˆ
  expect(response.body.error).toBeDefined()
})
```

---

## 9ï¸âƒ£ å…¼å®¹æ€§æµ‹è¯•

### 9.1 ä¸åŒNodeç‰ˆæœ¬

```bash
# ä½¿ç”¨nvmæµ‹è¯•ä¸åŒç‰ˆæœ¬
nvm use 16 && npm test
nvm use 18 && npm test
nvm use 20 && npm test
```

### 9.2 ä¸åŒæµè§ˆå™¨

```javascript
describe('æµè§ˆå™¨å…¼å®¹æ€§', () => {
  ['chromium', 'firefox', 'webkit'].forEach(browserType => {
    test(`${browserType} å…¼å®¹æ€§`, async () => {
      const browser = await playwright[browserType].launch()
      const page = await browser.newPage()
      await page.goto('http://localhost:5173')

      // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
      await page.fill('textarea', 'æµ‹è¯•')
      await page.click('button:has-text("æäº¤")')

      const result = await page.waitForSelector('.result')
      expect(result).toBeTruthy()

      await browser.close()
    })
  })
})
```

---

## ğŸ”Ÿ ç”¨æˆ·ä½“éªŒæµ‹è¯•

### 10.1 åŠ è½½æ—¶é—´

```javascript
test('é¦–å±åŠ è½½<2ç§’', async () => {
  const start = Date.now()
  await page.goto('http://localhost:5173')
  await page.waitForLoadState('domcontentloaded')
  const duration = Date.now() - start

  expect(duration).toBeLessThan(2000)
})
```

### 10.2 å¯è®¿é—®æ€§æµ‹è¯•

```javascript
test('é”®ç›˜å¯¼èˆª', async () => {
  await page.goto('http://localhost:5173')

  // Tabé”®å¯¼èˆª
  await page.keyboard.press('Tab')
  await page.keyboard.press('Tab')
  await page.keyboard.press('Enter')

  // éªŒè¯åŠŸèƒ½æ­£å¸¸
})

test('å±å¹•é˜…è¯»å™¨æ”¯æŒ', async () => {
  await page.goto('http://localhost:5173')

  // æ£€æŸ¥ARIAæ ‡ç­¾
  const hasAriaLabels = await page.evaluate(() => {
    const buttons = document.querySelectorAll('button')
    return Array.from(buttons).every(btn =>
      btn.hasAttribute('aria-label') || btn.textContent
    )
  })

  expect(hasAriaLabels).toBe(true)
})
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### ä»£ç è¦†ç›–ç‡
- **è¡Œè¦†ç›–ç‡**: >80%
- **åˆ†æ”¯è¦†ç›–ç‡**: >75%
- **å‡½æ•°è¦†ç›–ç‡**: >85%
- **è¯­å¥è¦†ç›–ç‡**: >80%

### åŠŸèƒ½è¦†ç›–ç‡
- **æ ¸å¿ƒåŠŸèƒ½**: 100%
- **è¾¹ç•Œæƒ…å†µ**: >90%
- **é”™è¯¯å¤„ç†**: >85%
- **æ€§èƒ½è¦æ±‚**: 100%

---

## ğŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ

### CI/CDé›†æˆ

```yaml
# .github/workflows/test.yml
name: æµ‹è¯•

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install
      - run: npm run test:unit
      - run: npm run test:integration
      - run: npm run test:e2e
      - run: npm run test:coverage
```

### æµ‹è¯•è„šæœ¬

```json
{
  "scripts": {
    "test": "jest",
    "test:unit": "jest tests/unit",
    "test:integration": "jest tests/integration",
    "test:e2e": "playwright test",
    "test:coverage": "jest --coverage",
    "test:watch": "jest --watch",
    "test:stress": "node tests/stress/stress-test.js",
    "test:security": "npm audit && node tests/security/security-test.js"
  }
}
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Š

### ç”ŸæˆæŠ¥å‘Š

```bash
# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
npm run test:stress -- --report

# ç”Ÿæˆå®Œæ•´æµ‹è¯•æŠ¥å‘Š
npm run test -- --reporters=default --reporters=jest-html-reporter
```

### æŠ¥å‘Šå†…å®¹

1. **æµ‹è¯•æ‰§è¡Œæ‘˜è¦**
2. **é€šè¿‡/å¤±è´¥ç»Ÿè®¡**
3. **ä»£ç è¦†ç›–ç‡**
4. **æ€§èƒ½æŒ‡æ ‡**
5. **å¤±è´¥è¯¦æƒ…**
6. **æ”¹è¿›å»ºè®®**

---

## ğŸ¯ æµ‹è¯•ä¼˜å…ˆçº§

### P0 - å…³é”®ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰
- æ ¸å¿ƒç¿»è¯‘æµç¨‹
- APIå¯†é’¥éªŒè¯
- æ•°æ®å®‰å…¨
- é”™è¯¯å¤„ç†

### P1 - é‡è¦ï¼ˆ>95%é€šè¿‡ï¼‰
- æ–‡ä»¶å¤„ç†
- ç¼“å­˜æœºåˆ¶
- æ€§èƒ½æŒ‡æ ‡
- å¹¶å‘å¤„ç†

### P2 - ä¸€èˆ¬ï¼ˆ>90%é€šè¿‡ï¼‰
- UIäº¤äº’
- æ—¥å¿—è®°å½•
- è¾¹ç•Œæƒ…å†µ
- å…¼å®¹æ€§

### P3 - æ¬¡è¦ï¼ˆ>80%é€šè¿‡ï¼‰
- ä¼˜åŒ–åŠŸèƒ½
- è¾…åŠ©åŠŸèƒ½
- æ–‡æ¡£æµ‹è¯•

---

## ğŸ”„ æŒç»­æ”¹è¿›

### æ¯å‘¨
- è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- å®¡æŸ¥å¤±è´¥æ¡ˆä¾‹
- æ›´æ–°æµ‹è¯•ç”¨ä¾‹

### æ¯æœˆ
- ä»£ç è¦†ç›–ç‡åˆ†æ
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- å®‰å…¨å®¡è®¡

### æ¯å­£åº¦
- å‹åŠ›æµ‹è¯•
- ç”¨æˆ·åé¦ˆæµ‹è¯•
- å…¼å®¹æ€§æ›´æ–°

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] E2Eæµ‹è¯•é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡>80%
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] å“åº”æ—¶é—´è¾¾æ ‡
- [ ] å¹¶å‘æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡
- [ ] æµè§ˆå™¨å…¼å®¹
- [ ] æ–‡æ¡£æ›´æ–°

---

**æµ‹è¯•è®¡åˆ’ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-29  
**æ›´æ–°å‘¨æœŸ**: æ¯æœˆå®¡æŸ¥


